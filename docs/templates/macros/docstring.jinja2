{% macro format_docstring(docstring) %}
{% if docstring is mapping %}
    {%- set content = docstring.value -%}
    {%- set content = content.replace(':\n-', ':\n\n-') -%}
    {%- set content = content.replace('\n        ', ' ') -%}
    {%- set content = content.replace(':param ', '\n**Parameters**\n\n- **') -%}
    {%- set content = content.replace(': ', '**: ', 1) -%}
    {%- set content = content.replace(':return: ', '\n**Returns**\n\n- ') -%}
    {%- set lines = content.split('\n') -%}
    {%- set formatted_lines = [] -%}
    {%- for line in lines -%}
        {%- if line.startswith('### ') -%}
            {%- set line = line.replace('### ', '###### ') -%}
        {%- elif line.strip() == 'Args:' -%}
            {%- set line = '**Arguments**\n' -%}
        {%- elif line.strip() == 'Attributes:' -%}
            {%- set line = '**Attributes**\n' -%}
        {%- elif line.strip() == 'Raises:' -%}
            {%- set line = '**Raises**\n' -%}
        {%- elif line.strip() == 'Returns:' -%}
            {%- set line = '**Returns**\n' -%}
        {%- elif line.startswith('    ') -%}
            {%- set trimmed = line.strip() -%}
            {%- if ':' in trimmed -%}
                {%- set parts = trimmed.split(':', 1) -%}
                {%- set param = parts[0].strip() -%}
                {%- set desc = parts[1].strip() -%}
                {%- if '[DEPRECATED]' in desc -%}
                    {%- set desc = desc.replace('[DEPRECATED]', '') ~ '^[**Deprecation notice**<br>`' ~ param ~ '` has been deprecated and will be removed in a future release.]' -%}
                {%- endif -%}
                {%- set line = '- **' ~ param ~ '**: ' ~ desc -%}
            {%- else -%}
                {%- set line = '- ' ~ trimmed -%}
            {%- endif -%}
        {%- endif -%}
        {%- if line.strip() or line.startswith('    ') -%}
            {%- set _ = formatted_lines.append(line) -%}
        {%- else -%}
            {%- set _ = formatted_lines.append('') -%}
        {%- endif -%}
    {%- endfor -%}
{{ formatted_lines | join('\n') }}

{% if docstring.params %}
**Parameters:**
{% for param in docstring.params %}
 `{{ param.name }}`: {{ param.description }}
{% endfor %}
{% endif %}

{% if docstring.returns %}
**Returns:**
{{ docstring.returns }}
{% endif %}

{% if docstring.raises %}
**Raises:**
{% for error in docstring.raises %}
 `{{ error.type }}`: {{ error.description }}
{% endfor %}
{% endif %}
{% else %}
{{ docstring }}

{% endif %}
{% endmacro %} 